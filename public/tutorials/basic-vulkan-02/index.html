<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.37" />

  <title>Basic Vulkan 02 &middot; Learn Graphics Programming</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  

  <link rel="shortcut icon" href="https://www.learngfxprogramming.cf/img/favicon.ico" type="image/x-icon" />

  
    <link rel="stylesheet" href="https://www.learngfxprogramming.cf/css/syntax.css">
  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/">Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/tutorials">Tutorials</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/shaheansar" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://gitlab.com/shaheansar123323" target="_blank"><i class="fa fa-gitlab fa-fw"></i>GitLab</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; Copyright 2018 M. Shahe Ansar</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Basic Vulkan 02</h1>
  <h2></h2>
</div>
<div class="content">
  

<h1 id="understanding-what-an-instance-is">Understanding what an instance is</h1>

<p>In vulkan, the main object you&rsquo;ll be interacting with is an instance. The instance is similar to Open GL&rsquo;s concept of contexts.
You can think of it as an object that holds details that tells vulkan that we&rsquo;re a vulkan application. In reality, it simply holds a bunch of state
for the vulkan API. Creating it is the first step to creating any vulkan application. You can pass a bunch of information, and we certainly will later down the road.
But today, I&rsquo;ll be showing you how to create an instance.</p>

<p><strong>NOTE:</strong> You WILL not be seeing anything on screen until much later (since this is vulkan). Drawing on it will come even later.</p>

<h1 id="setting-up-the-skeleton-of-the-codebase">Setting up the skeleton of the codebase</h1>

<p>Let&rsquo;s continue from the last article&rsquo;s barebones main.cpp file.<br />
We want to keep the clutter to a minimum. So let&rsquo;s put three functions within the main function</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> 
<span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
	<span class="n">Game</span><span class="o">::</span><span class="n">init</span><span class="p">();</span>
	<span class="n">Game</span><span class="o">::</span><span class="n">loop</span><span class="p">();</span>
	<span class="n">Game</span><span class="o">::</span><span class="n">deinit</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>We want to keep the main game code in a separate namespace, so that we&rsquo;ll not clash in the future with other libraries (That isn&rsquo;t going to happen
in this series, but if you want to evolve this into a game engine, starting here is a good idea). Now let&rsquo;s define them in file called <code>game.hpp</code>.
I&rsquo;m not going to be making a separate cpp file because the code will be fairly small.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">namespace</span> <span class="n">Game</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">init</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="c1">//init code
</span><span class="c1"></span>	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="c1">//loop code
</span><span class="c1"></span>	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">deinit</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="c1">//deinit code
</span><span class="c1"></span>	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>We can finally get to vulkan now. We&rsquo;ll keep that in another namespace called Gfx. So let&rsquo;s add two other files <code>src/gfx.hpp</code> and <code>src/gfx.cpp</code></p>

<p><code>src/gfx.hpp</code></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#define GLFW_VULKAN_INCLUDED </span><span class="c1">//automatically loads all needed vulkan headers
</span><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;GLFW/glfw3.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">namespace</span> <span class="n">Gfx</span>
<span class="p">{</span>
	<span class="k">class</span> <span class="nc">Renderer</span>
	<span class="p">{</span>
		<span class="n">VkInstance</span> <span class="n">_instance</span><span class="p">;</span> <span class="c1">// The underscore in front of it is my convention for a member variable
</span><span class="c1"></span>	<span class="k">public</span><span class="o">:</span>
		<span class="n">init</span><span class="p">();</span> <span class="c1">// I&#39;m doing this in a separate function to be explicit while using it. 
</span><span class="c1"></span>			<span class="c1">//If you want to, you can use the constructor and destructor, and take advantage of RAII, but I prefer to do it this way
</span><span class="c1"></span>		<span class="n">deinit</span><span class="p">();</span>
	<span class="p">};</span>
<span class="p">};</span>
</code></pre></div>
<p><code>src/gfx.cpp</code></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&#34;gfx.hpp&#34;</span><span class="cp">
</span><span class="cp"></span><span class="kt">void</span> <span class="n">Gfx</span><span class="o">::</span><span class="n">Renderer</span><span class="o">::</span><span class="n">init</span><span class="p">()</span>
<span class="p">{</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="n">Gfx</span><span class="o">::</span><span class="n">Renderer</span><span class="o">::</span><span class="n">deinit</span><span class="p">()</span>
<span class="p">{</span>

<span class="p">}</span>
</code></pre></div>
<h1 id="actually-coding">Actually coding</h1>

<p>Now let&rsquo;s talk about what will go inside the above two functions.<br />
In the init function we want to initialize the instance. We also want to pass in some information about our game / game-engine to the instance&rsquo;s create function.
In the deinit function, we&rsquo;ll have to destroy the data that&rsquo;s put into it.
So let&rsquo;s get to it.</p>

<p><code>Gfx::Renderer::init()</code></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">VkApplicationInfo</span> <span class="n">appInfo</span> <span class="o">=</span> <span class="p">{};</span>
<span class="n">appInfo</span><span class="p">.</span><span class="n">sType</span> <span class="o">=</span> <span class="n">VK_STRUCTURE_TYPE_APPLICATION_INFO</span><span class="p">;</span>
<span class="n">appInfo</span><span class="p">.</span><span class="n">pApplicationName</span> <span class="o">=</span> <span class="sa"></span><span class="s">&#34;Name of our Application&#34;</span><span class="p">;</span>
<span class="n">appInfo</span><span class="p">.</span><span class="n">applicationVersion</span> <span class="o">=</span> <span class="n">VK_MAKE_VERSION</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// Follows this format - (MAJOR, MINOR, PATCH)
</span><span class="c1"></span><span class="n">appIngo</span><span class="p">.</span><span class="n">pEngineName</span> <span class="o">=</span> <span class="sa"></span><span class="s">&#34;Engine Name&#34;</span><span class="p">;</span>
<span class="n">appInfo</span><span class="p">.</span><span class="n">engineVersion</span> <span class="o">=</span> <span class="n">VK_MAKE_VERSION</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">appInfo</span><span class="p">.</span><span class="n">apiVersion</span> <span class="o">=</span> <span class="n">VK_API_VERSION_1_0</span><span class="p">;</span>
</code></pre></div>
<p>The above section is completely optional, but still good practice, since engine and game specific optimizations
can be done by the driver for you engine (if it ever becomes big enough).<br />
But more importantly, this section tells us something very important about vulkan - it&rsquo;s struct based.
You will almost certainly pass a struct before every function call. Think this sucks? Well, deal with it. It&rsquo;s a low
level library that is by design extremely verbose.<br />
One <strong>very</strong> important thing to keep in mind is that every structure you&rsquo;ll make that&rsquo;s of a vulkan defined type,
will have the <code>sType</code> field. It, of course stands for <code>structure Type</code>. You <strong>must</strong> always fill it up.<br />
Now onto actually creating the instance-</p>

<p><code>Gfx::Renderer::init()</code></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="p">...</span> <span class="c1">//Created the appInfo
</span><span class="c1"></span><span class="n">VkInstanceCreateInfo</span> <span class="n">instanceCreateInfo</span> <span class="o">=</span> <span class="p">{};</span>
<span class="n">instanceCreateinfo</span><span class="p">.</span><span class="n">sType</span> <span class="o">=</span> <span class="n">VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO</span><span class="p">;</span>
<span class="n">instanceInfo</span><span class="p">.</span><span class="n">pApplicationInfo</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">appInfo</span><span class="p">;</span>
<span class="n">instanceInfo</span><span class="p">.</span><span class="n">enabledLayerCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Debugging stuff. We&#39;ll get to this later
</span><span class="c1"></span><span class="n">instanceInfo</span><span class="p">.</span><span class="n">enabledExtensionCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Again, we&#39;ll get to this later. I&#39;ll simply use || to represent that
</span><span class="c1"></span><span class="n">instanceInfo</span><span class="p">.</span><span class="n">ppEnabledExtensionNames</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span> <span class="c1">// ||
</span><span class="c1"></span><span class="n">instanceInfo</span><span class="p">.</span><span class="n">ppEnabledLayerNames</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span> <span class="c1">// ||
</span><span class="c1"></span>
<span class="k">if</span><span class="p">(</span><span class="n">vkCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">instanceCreateInfo</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_instance</span><span class="p">)</span> <span class="o">!=</span> <span class="n">VK_SUCCESS</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="sa"></span><span class="s">&#34;ERROR: Unable to create instance!!!&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
	<span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>I&rsquo;ll first start explaining a few conventions in the vulkan library, then explain what I did -</p>

<ul>
<li>If you&rsquo;re creating anything, you&rsquo;ll be creating a *CreateInfo struct for that.</li>
<li>All fields and parameters have <code>p</code> prepended to them to denote a pointer. Two <code>p</code>s denote a double pointer</li>
<li>Every function that creates something will take a *CreateInfo struct, a pointer to an allocator (will not be used in this series, but will be discussed much later), and a pointer to the object it creates.</li>
<li>Every function will return a VK_Result, and it&rsquo;ll have the value <code>VK_SUCCESS</code> if it succeeds, otherwise, some other value.<br /></li>
</ul>

<p>With that said and done, let&rsquo;s talk about a few things in the above piece of code.<br />
You&rsquo;ll see two pairs of peculiar fields when filling the struct up - <code>enabledLayerCount and ppEnabledLayerNames</code> and <code>enabledExtensionCount and ppEnabledExtensionNames</code>.<br />
Layers in particular are interesting. I&rsquo;ll explain them in more detail down the road, but they&rsquo;re a superb debugging mechanism that lets us add hooks to Vulkan library functions and print details if things go wrong.<br />
Extensions on the other hand let us add extra functionality to the core Vulkan libraries.
For example, since Vulkan is platform agnostic, we need an extension to access the handler to
the surface of a window.<br />
All of that though is for the next tutorial, where we&rsquo;ll enable a few extensions and layers.</p>

<p>Now let&rsquo;s fill up the <code>Gfx::Renderer::deinit()</code> function, which contains a single line of code-<br />
<code>Gfx::Renderer::deinit()</code></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">vkDestroyInstance</span><span class="p">(</span><span class="n">_instance</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span><span class="c1">// Also keep in mind that all functions that destroy objects also take
</span><span class="c1"></span>                                      <span class="c1">// a parameter to an allocator. We don&#39;t need one, so it&#39;s a nullptr
</span><span class="c1"></span></code></pre></div>
<p>Now let&rsquo;s set everything up.<br />
We want to include all the needed headers and call the proper functions.<br />
<code>main.cpp</code></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&#34;game.hpp&#34;</span><span class="cp">
</span><span class="cp"></span></code></pre></div>
<p><code>game.hpp</code></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#include</span> <span class="cpf">&#34;gfx.hpp</span><span class="cp">
</span><span class="cp"></span><span class="p">...</span>
	<span class="n">Renderer</span> <span class="n">renderer</span><span class="p">;</span>
	<span class="n">init</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">renderer</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="p">...</span>
	<span class="n">deinit</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">renderer</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span>
	<span class="p">}</span>
</code></pre></div>
<p>And that&rsquo;s it. We&rsquo;re almost done now. All that&rsquo;s left is modifying the <code>meson.build</code> file.</p>

<h1 id="modifying-meson-build">Modifying meson.build</h1>

<p>Open up the meson.build file and change the following variables like this -</p>
<div class="highlight"><pre class="chroma"><code class="language-ruby`" data-lang="ruby`">src = [&#39;src/main.cpp&#39;, &#39;src/gfx.cpp&#39;]</code></pre></div>
<p>Now, go to the build directory and run <code>ninja</code>. You shouldn&rsquo;t get any errors and have a compiled project
that does nothing for now. Hey, at least we have progress.<br />
On my next post (which will be pretty big, I think) we&rsquo;ll talk about layers and extensions.<br />
Till then, ciao</p>

</div>

</div>
</div>
<script src="https://www.learngfxprogramming.cf/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-115000283-1', 'auto');
  ga('send', 'pageview');

</script>





</body>
</html>

